<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js'></script>

    <link rel="stylesheet" href="./customStyle.css" />
    
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.css">
    <link rel="stylesheet" type="text/css" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/MarkerCluster.Default.css" />

    <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script>
    <script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet/0.0.1-beta.5/esri-leaflet.js"></script>
    <script src="https://cdn-geoweb.s3.amazonaws.com/esri-leaflet-geocoder/0.0.1-beta.5/esri-leaflet-geocoder.js"></script>
    <script type='text/javascript' src='http://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/0.4.0/leaflet.markercluster.js'></script>

  </head>
  <body>
    <!-- add listing map start -->
    <h2>Add listing map</h2>
    <div id="sv-map">
      <div id="addListingMap"></div>
    </div>
    <div class='pointer'></div>

    <footer>
      <input name="lat" id="lat" placeholder="Latitude" />
      <input name="long" id="long" placeholder="Longitude" />
      <button type="button" id="currentLocation">Location</button>
    </footer>
  <!-- add listing map end -->

  <!-- single Listing map -->
  <h2>Single listing map</h2>
  <div id="singleListingMap"></div>

  <!-- all Listing map -->
  <h2>All listing map</h2>
  <div id="allListingMap"></div>

  <script>
    // add listing map start here
      var globalLat = 35.10418;
      var globalLong = -106.6287;

      var idLat = document.getElementById('lat');
      var idLong = document.getElementById('long');

      idLat.value = globalLat;
      idLong.value = globalLong;

      function sovwareOsmMap(initLat, initLng) {

        var map = L.map('addListingMap', {    
            center: [initLat, initLng],
            zoom: 10
        });
  
        L.control.scale().addTo(map);
        
        L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(map);
  
          var searchControl = new L.esri.Controls.Geosearch().addTo(map);
          var results = new L.LayerGroup().addTo(map);
  
          var myMarker = L.marker([initLat, initLng], {title: "MyPoint", alt: "The Big I", draggable: true})
            .addTo(map)
            .on('dragend', function() {
              var coord = String(myMarker.getLatLng()).split(',');            
              var lat = coord[0].split('(');
              var lng = coord[1].split(')');
  
              idLat.value = lat[1];
              idLong.value = lng;            
              myMarker.bindPopup("Moved to: " + lat[1] + ", " + lng[0] + ".");
            });
      
          searchControl.on('results', function(data){
            results.clearLayers();
            for (var i = data.results.length - 1; i >= 0; i--) {           
              idLat.value = data.results[i].latlng.lat;
              idLong.value = data.results[i].latlng.lng;
  
              var myMarker = L.marker(data.results[i].latlng, {title: "MyPoint", alt: "The Big I", draggable: true})
              .addTo(map)
              .on('dragend', function() {
                var coord = String(myMarker.getLatLng()).split(',');
                var lat = coord[0].split('(');              
                var lng = coord[1].split(')');              
                idLat.value = lat[1];
                idLong.value = lng; 
                myMarker.bindPopup("Moved to: " + lat[1] + ", " + lng[0] + ".");
              });
              results.addLayer(myMarker);
            }
          });
      }

      sovwareOsmMap(globalLat, globalLong);

        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(showPosition);
          }
        }

        function showPosition(position) { 
          document.getElementById('sv-map').innerHTML = "<div id='addListingMap'></div>";
          sovwareOsmMap(position.coords.latitude, position.coords.longitude)
          idLat.value = position.coords.latitude;
          idLong.value = position.coords.longitude;
        }
      
      document.getElementById('currentLocation').addEventListener('click', function(){
        getLocation();
      });
  // add listing map close here
  </script>
  <script>
    // single listing map
    var longLate ={
          late: 23.7535,
          long: 90.4003584
    }
    
    var map = L.map('singleListingMap').setView([longLate.late, longLate.long], 19);
    const fontAwesomeIcon = L.divIcon({
        html: '<i class="fa fa-map-marker fa-3x"></i>',
        iconSize: [20, 20],
        iconAnchor:   [10, 36],
        popupAnchor:  [0, -20],
        className: 'myDivIcon'
    });
    // add the OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      tileSize: 512,
      zoomOffset: -1,
      attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
    }).addTo(map);

    // show the scale bar on the lower left corner
    L.control.scale().addTo(map);

    // show a marker on the map
    L.marker({lon: longLate.long, lat: longLate.late}, { icon:  fontAwesomeIcon}).bindPopup('A pretty CSS3 popup.<br> Easily customizable.').addTo(map).openPopup();
  </script>

  <script>
    // All listing
    var markers = [
        {
          "name":"Goroka",
          "city":"Goroka, Papua New Guinea",
          "iata_faa":"GKA",
          "icao":"AYGA",
          "lat":-6.081689,
          "lng":145.391881,
          "alt":5282,
          "tz":"Pacific/Port_Moresby"
        },{
          "name":"Madang",
          "city":"Madang, Papua New Guinea",
          "iata_faa":"MAG",
          "icao":"AYMD",
          "lat":-5.207083,
          "lng":145.7887,
          "alt":20,
          "tz":"Pacific/Port_Moresby"
        },{
          "name":"San Diego Old Town Transit Center",
          "city":"San Diego, United States",
          "iata_faa":"OLT",
          "lat":32.7552,
          "lng":-117.1995,
          "alt":0,
          "tz":"America/Los_Angeles"
        }
      ];

    
    var tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });

    var map = L.map( 'allListingMap', {
      center: [10.0, 5.0],
      minZoom: 2,
      maxZoom: 19,
      zoom: 2,
      layers: [tiles]
    });
          
    var markerClusters = L.markerClusterGroup(); 
    for ( var i = 0; i < markers.length; ++i )
    {
      var popup = markers[i].name +
                  '<br/>' + markers[i].city +
                  '<br/><b>IATA/FAA:</b> ' + markers[i].iata_faa +
                  '<br/><b>ICAO:</b> ' + markers[i].icao +
                  '<br/><b>Altitude:</b> ' + Math.round( markers[i].alt * 0.3048 ) + ' m' +
                  '<br/><b>Timezone:</b> ' + markers[i].tz;
    
      var m = L.marker( [markers[i].lat, markers[i].lng], {icon: fontAwesomeIcon} )
                      .bindPopup( popup );
    
      markerClusters.addLayer( m );
    }      
    map.addLayer( markerClusters );
  </script>

  </body>
</html>